<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>MD5</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1">
  </head>
  <body>
    <h3 style="text-align: center;">MD5</h3>

    <form
      style="width: 80%; margin: 0 auto;"
      action='#'
      method='post'>
      Email:
      <br>
      <input
        style="width: 100%; margin-bottom: 20px"
        type='text'
        name='inputDataEmail'
        id='inputDataEmail'>
      Password:
      <br>
      <input
        style="width: 100%; margin-bottom: 20px"
        type='text'
        name='inputDataPassword'
        id='inputDataPassword'>
      <br>
      <input
        style="width: 100%; margin-bottom: 20px"
        type='button'
        id='SignInMd5'
        value='MD5'>
      <br>
      Result password hash code:
      <br>
      <input
        style="width: 100%;"
        type='text'
        name='hashResult'
        id='hashResult'>
    </form>
    <script>
        const MD5 = (s) => {
            // Let [abcd k s i] denote the operation a = b + ((a + F(b,c,d) + X[k] + T[i]) <<< s).
            const k = (a, b, c, d, x, s, t) => {
                const n = a + (b & c | ~b & d) + (x >>> 0) + t;
                return ((n << s) | (n >>> (32 - s))) + b;
            }
            // Let [abcd k s i] denote the operation a = b + ((a + G(b,c,d) + X[k] + T[i]) <<< s).
            const l = (a, b, c, d, x, s, t) => {
                const n = a + (b & d | c & ~d) + (x >>> 0) + t;
                return ((n << s) | (n >>> (32 - s))) + b;
            }
            // Let [abcd k s t] denote the operation a = b + ((a + H(b,c,d) + X[k] + T[i]) <<< s).
            const m = (a, b, c, d, x, s, t) => {
                const n = a + (b ^ c ^ d) + (x >>> 0) + t;
                return ((n << s) | (n >>> (32 - s))) + b;
            }
            // Let [abcd k s t] denote the operation a = b + ((a + I(b,c,d) + X[k] + T[i]) <<< s).
            const n = (a, b, c, d, x, s, t) => {
                const n = a + (c ^ (b | ~d)) + (x >>> 0) + t;
                return ((n << s) | (n >>> (32 - s))) + b;
            }
            // Intermediate hash value
            const p = (a) => {
                let b = "", d = "", c;
                // 'Endianness' convert the bytes to the canonical byte order
                for (c = 0; 3 >= c; c++) {
                    d = a >>> 8 * c & 255, d = "0" + d.toString(16), b += d.substr(d.length - 2, 2);
                }
                return b
            }
            var f = [], q, r, s, t, a, b, c, d;
            f = function(b) {
                var a, c = b.length;
                a = c + 8;
                // 448 module 512 
                for (var d = 16 * ((a - a % 64) / 64 + 1), e = Array(d - 1), f = 0, g = 0; g < c;) {
                    a = (g - g % 4) / 4, f = g % 4 * 8, e[a] |= b.charCodeAt(g) << f, g++;
                }
                a = (g - g % 4) / 4;
                e[a] |= 128 << g % 4 * 8;
                e[d - 2] = c << 3;
                e[d - 1] = c >>> 29;
                return e
            }(s);
            // init const
a = 1732584193;
            b = 4023233417;
            c = 2562383102;
            d = 271733878;
            for (e = 0; e < f.length; e += 16) {
                q = a;
                r = b;
                s = c;
                t = d;
                // Round 1.
                a = k(a, b, c, d, f[e + 0], 7, -680876936);
                d = k(d, a, b, c, f[e + 1], 12, -389564586);
                c = k(c, d, a, b, f[e + 2], 17, 606105819);
                b = k(b, c, d, a, f[e + 3], 22, -1044525330);
                a = k(a, b, c, d, f[e + 4], 7, -176418897);
                d = k(d, a, b, c, f[e + 5], 12, 1200080426);
                c = k(c, d, a, b, f[e + 6], 17, -1473231341);
                b = k(b, c, d, a, f[e + 7], 22, -45705983);
                a = k(a, b, c, d, f[e + 8], 7, 1770035416);
                d = k(d, a, b, c, f[e + 9], 12, -1958414417);
                c = k(c, d, a, b, f[e + 10], 17, -42063);
                b = k(b, c, d, a, f[e + 11], 22, -1990404162);
                a = k(a, b, c, d, f[e + 12], 7, 1804603682);
                d = k(d, a, b, c, f[e + 13], 12, -40341101);
                c = k(c, d, a, b, f[e + 14], 17, -1502002290);
                b = k(b, c, d, a, f[e + 15], 22, 1236535329);
                // Round 2.
                a = l(a, b, c, d, f[e + 1], 5, -165796510);
                d = l(d, a, b, c, f[e + 6], 9, -1069501632);
                c = l(c, d, a, b, f[e + 11], 14, 643717713);
                b = l(b, c, d, a, f[e + 0], 20, -373897302);
                a = l(a, b, c, d, f[e + 5], 5, -701558691);
                d = l(d, a, b, c, f[e + 10], 9, 38016083);
                c = l(c, d, a, b, f[e + 15], 14, -660478335);
                b = l(b, c, d, a, f[e + 4], 20, -405537848);
                a = l(a, b, c, d, f[e + 9], 5, 568446438);
                d = l(d, a, b, c, f[e + 14], 9, -1019803690);
                c = l(c, d, a, b, f[e + 3], 14, -187363961);
                b = l(b, c, d, a, f[e + 8], 20, 1163531501);
                a = l(a, b, c, d, f[e + 13], 5, -1444681467);
                d = l(d, a, b, c, f[e + 2], 9, -51403784);
                c = l(c, d, a, b, f[e + 7], 14, 1735328473);
                b = l(b, c, d, a, f[e + 12], 20, -1926607734);
                // Round 3.
                a = m(a, b, c, d, f[e + 5], 4, -378558);
                d = m(d, a, b, c, f[e + 8], 11, -2022574463);
                c = m(c, d, a, b, f[e + 11], 16, 1839030562);
                b = m(b, c, d, a, f[e + 14], 23, -35309556);
                a = m(a, b, c, d, f[e + 1], 4, -1530992060);
                d = m(d, a, b, c, f[e + 4], 11, 1272893353);
                c = m(c, d, a, b, f[e + 7], 16, -155497632);
                b = m(b, c, d, a, f[e + 10], 23, -1094730640);
                a = m(a, b, c, d, f[e + 13], 4, 681279174);
                d = m(d, a, b, c, f[e + 0], 11, -358537222);
                c = m(c, d, a, b, f[e + 3], 16, -722521979);
                b = m(b, c, d, a, f[e + 6], 23, 76029189);
                a = m(a, b, c, d, f[e + 9], 4, -640364487);
                d = m(d, a, b, c, f[e + 12], 11, -421815835);
                c = m(c, d, a, b, f[e + 15], 16, 530742520);
                b = m(b, c, d, a, f[e + 2], 23, -995338651);
                // Round 4.
                a = n(a, b, c, d, f[e + 0], 6, -198630844);
                d = n(d, a, b, c, f[e + 7], 10, 1126891415);
                c = n(c, d, a, b, f[e + 14], 15, -1416354905);
                b = n(b, c, d, a, f[e + 5], 21, -57434055);
                a = n(a, b, c, d, f[e + 12], 6, 1700485571);
                d = n(d, a, b, c, f[e + 3], 10, -1894986606);
                c = n(c, d, a, b, f[e + 10], 15, -1051523);
                b = n(b, c, d, a, f[e + 1], 21, -2054922799);
                a = n(a, b, c, d, f[e + 8], 6, 1873313359);
                d = n(d, a, b, c, f[e + 15], 10, -30611744);
                c = n(c, d, a, b, f[e + 6], 15, -1560198380);
                b = n(b, c, d, a, f[e + 13], 21, 1309151649);
                a = n(a, b, c, d, f[e + 4], 6, -145523070);
                d = n(d, a, b, c, f[e + 11], 10, -1120210379);
                c = n(c, d, a, b, f[e + 2], 15, 718787259);
                b = n(b, c, d, a, f[e + 9], 21, -343485551);
                a = (a + q) >>> 0;
                b = (b + r) >>> 0;
                c = (c + s) >>> 0;
                d = (d + t) >>> 0;
            }
            // Then perform the following additions. (That is increment each 
            // of the four registers by the value it had before this block was started.)
            return (p(a) + p(b) + p(c) + p(d)).toLowerCase();
        }
const auth = (method, mode) => {
            const email = document.getElementById('inputDataEmail').value;
            const password = document.getElementById('inputDataPassword').value;
            const hash = method === 'sha256' ? SHA256(password) : MD5(password);
            document.getElementById('hashResult').value = hash;
            mode === 'sign in' ? signIn(email, hash) : signUp(email, hash);
        }
        const request = (method, url, data) => {
            const xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    alert('Successful:' + this.responseText)
                } else if (this.readyState == 4 && this.status == 400) {
                    alert('Failure: ' + this.responseText)
                }
            };
            xhttp.open(method, url, true);
            xhttp.setRequestHeader("Content-type", "application/json");
            xhttp.send(data);
        }
        const signUp = (email, password) => {
            request("POST", 'http://localhost:3000/api/users/signup', JSON.stringify({
                email,
                password
            }));
        }
        const signIn = (email, password) => {
            request("POST", 'http://localhost:3000/api/users/signin', JSON.stringify({
                email,
                password
            }));
        }
        
        document.getElementById('SignInMd5').onclick = () => {
            auth('md5', 'sign in');
            return false;
        }

      
        document.getElementById('SignUpMd5').onclick = () => {
            auth('md5', 'sign up');
            return false;
        }
    </script>
  </body>
</html>
